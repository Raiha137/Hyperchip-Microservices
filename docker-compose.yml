#..... D:\Microservice\Ecommerce Projects\docker-compose.yml .....#



version: "3.8"

services:

  # ===========================
  # Config Server
  # ===========================
  config-server:
    build: ./HyperchipConfigServer
    container_name: config-server
    ports:
      - "8888:8888"
    env_file:
      - .env

  # ===========================
  # Eureka Discovery Server
  # ===========================
  discovery:
    build: ./HyperchipDiscovery
    container_name: discovery
    ports:
      - "8761:8761"
    depends_on:
      - config-server
    env_file:
      - .env

  # ===========================
  # API Gateway
  # ===========================
  api-gateway:
    build: ./HyperchipApiGateway
    container_name: api-gateway
    ports:
      - "8080:8080"
    depends_on:
      - config-server
      - discovery
    environment:
      SPRING_PROFILES_ACTIVE: prod
      JAVA_OPTS: "-Deureka.client.service-url.defaultZone=http://discovery:8761/eureka"

  # ===========================
  # MySQL for Auth Service
  # ===========================
  auth-mysql:
    image: mysql:8
    container_name: auth-mysql
    restart: always
    environment:
      MYSQL_DATABASE: ${AUTH_DB_NAME}
      MYSQL_ROOT_PASSWORD: ${AUTH_DB_PASSWORD}
    ports:
      - "3307:3306"
    volumes:
      - auth-db:/var/lib/mysql

  # ===========================
  # Auth Service
  # ===========================

  auth-service:
    build: ./HyperchipAuthService
    container_name: auth-service
    ports:
      - "8084:8084"
    env_file:
      - .env
    environment:
      SPRING_PROFILES_ACTIVE: prod

      # ðŸ”¹ Force Hibernate to CREATE tables
      SPRING_JPA_HIBERNATE_DDL_AUTO: update

      # ðŸ”¹ Database config
      SPRING_DATASOURCE_URL: jdbc:mysql://auth-mysql:3306/${AUTH_DB_NAME}?useSSL=false&serverTimezone=UTC&allowPublicKeyRetrieval=true
      SPRING_DATASOURCE_USERNAME: ${AUTH_DB_USER}
      SPRING_DATASOURCE_PASSWORD: ${AUTH_DB_PASSWORD}

      # ðŸ”¹ Other service configs
      USER_SERVICE_URL: ${USER_SERVICE_URL}
      USER_SERVICE_SSO_FINISH: ${USER_SERVICE_SSO_FINISH}
      SPRING_SECURITY_OAUTH2_CLIENT_REGISTRATION_GOOGLE_CLIENT_ID: ${GOOGLE_CLIENT_ID}
      SPRING_SECURITY_OAUTH2_CLIENT_REGISTRATION_GOOGLE_CLIENT_SECRET: ${GOOGLE_CLIENT_SECRET}
      SPRING_MAIL_USERNAME: ${SPRING_MAIL_USERNAME}
      SPRING_MAIL_PASSWORD: ${SPRING_MAIL_PASSWORD}

      # ðŸ”¹ Force Eureka URL
      JAVA_OPTS: "-Deureka.client.service-url.defaultZone=http://discovery:8761/eureka"

    depends_on:
      - auth-mysql
      - discovery

  # ===========================
  # MySQL for User Service
  # ===========================
  user-mysql:
    image: mysql:8
    container_name: user-mysql
    restart: always
    environment:
      MYSQL_DATABASE: ${USER_DB_NAME}
      MYSQL_ROOT_PASSWORD: ${USER_DB_PASSWORD}
    ports:
      - "3308:3306"
    volumes:
      - user-db:/var/lib/mysql

  # ===========================
  # User Service
  # ===========================
  user-service:
    build: ./HyperchipUser
    container_name: user-service
    ports:
      - "8083:8083"
    env_file:
      - .env
    environment:
      SPRING_PROFILES_ACTIVE: prod

      # Database (REQUIRED)
      SPRING_DATASOURCE_URL: jdbc:mysql://user-mysql:3306/${USER_DB_NAME}?createDatabaseIfNotExist=true&useSSL=false&serverTimezone=UTC&allowPublicKeyRetrieval=true
      SPRING_DATASOURCE_USERNAME: ${USER_DB_USER}
      SPRING_DATASOURCE_PASSWORD: ${USER_DB_PASSWORD}

      # Force Eureka (REQUIRED â€“ this fixes localhost issue)
      JAVA_OPTS: "-Deureka.client.service-url.defaultZone=http://discovery:8761/eureka"

      # Optional extras (safe)
      SPRING_MAIL_USERNAME: ${SPRING_MAIL_USERNAME}
      SPRING_MAIL_PASSWORD: ${SPRING_MAIL_PASSWORD}
      MASTER_SERVICE_URL: ${MASTER_SERVICE_URL}

    depends_on:
      - user-mysql
      - config-server
      - discovery

  # ===========================
  # MySQL for Admin Service
  # ===========================

  admin-mysql:
    image: mysql:8
    container_name: admin-mysql
    restart: always
    environment:
      MYSQL_DATABASE: ${ADMIN_DB_NAME}
      MYSQL_ROOT_PASSWORD: ${ADMIN_DB_PASSWORD}
    ports:
      - "3309:3306"
    volumes:
      - admin-db:/var/lib/mysql


  # ===========================
  # Admin Service
  # ===========================

  admin-service:
    build: ./HyperchipAdmin
    container_name: admin-service
    ports:
      - "8085:8085"
    env_file:
      - .env
    environment:
      SPRING_PROFILES_ACTIVE: prod
      SPRING_JPA_HIBERNATE_DDL_AUTO: update

      SPRING_DATASOURCE_URL: jdbc:mysql://admin-mysql:3306/${ADMIN_DB_NAME}?useSSL=false&serverTimezone=UTC&allowPublicKeyRetrieval=true
      SPRING_DATASOURCE_USERNAME: ${ADMIN_DB_USER}
      SPRING_DATASOURCE_PASSWORD: ${ADMIN_DB_PASSWORD}

      JAVA_OPTS: "-Deureka.client.service-url.defaultZone=http://discovery:8761/eureka"

    depends_on:
      - admin-mysql
      - discovery
      - config-server

  # ===========================
  # MySQL for Master Service
  # ===========================
  master-mysql:
    image: mysql:8
    container_name: master-mysql
    restart: always
    environment:
      MYSQL_DATABASE: ${MASTER_DB_NAME}
      MYSQL_ROOT_PASSWORD: ${MASTER_DB_PASSWORD}
    ports:
      - "3310:3306"
    volumes:
      - master-db:/var/lib/mysql

  # ===========================
  # Master Service
  # ===========================
  master-service:
    build: ./HyperchipMaster
    container_name: master-service
    ports:
      - "8086:8086"
    env_file:
      - .env
    environment:
      SPRING_PROFILES_ACTIVE: prod
      SPRING_JPA_HIBERNATE_DDL_AUTO: update
      SPRING_DATASOURCE_URL: jdbc:mysql://master-mysql:3306/${MASTER_DB_NAME}?useSSL=false&serverTimezone=UTC&allowPublicKeyRetrieval=true
      SPRING_DATASOURCE_USERNAME: ${MASTER_DB_USER}
      SPRING_DATASOURCE_PASSWORD: ${MASTER_DB_PASSWORD}
      JAVA_OPTS: "-Deureka.client.service-url.defaultZone=http://discovery:8761/eureka"
    depends_on:
      - master-mysql
      - discovery
      - config-server
  # ===========================
  # MySQL for Cart Service
  # ===========================
  cart-mysql:
    image: mysql:8
    container_name: cart-mysql
    restart: always
    environment:
      MYSQL_DATABASE: hyperchip_cart_db
      MYSQL_ROOT_PASSWORD: ${USER_DB_PASSWORD}
    ports:
      - "3311:3306"
    volumes:
      - cart-db:/var/lib/mysql

  # ===========================
  # Cart Service
  # ===========================
  cart-service:
    build: ./HyperchipCart
    container_name: cart-service
    ports:
      - "8091:8091"
    env_file:
      - .env
    environment:
      SPRING_PROFILES_ACTIVE: prod
      SPRING_DATASOURCE_URL: jdbc:mysql://cart-mysql:3306/hyperchip_cart_db?useSSL=false&serverTimezone=UTC&allowPublicKeyRetrieval=true
      SPRING_DATASOURCE_USERNAME: root
      SPRING_DATASOURCE_PASSWORD: ${USER_DB_PASSWORD}
      JAVA_OPTS: "-Deureka.client.service-url.defaultZone=http://discovery:8761/eureka"
    depends_on:
      - cart-mysql
      - discovery
      - config-server

  # ===========================
  # MySQL for Wishlist Service
  # ===========================
  wishlist-mysql:
    image: mysql:8
    container_name: wishlist-mysql
    restart: always
    environment:
      MYSQL_DATABASE: hyperchip_wishlist_db
      MYSQL_ROOT_PASSWORD: ${USER_DB_PASSWORD}
    ports:
      - "3312:3306"
    volumes:
      - wishlist-db:/var/lib/mysql

  # ===========================
  # Wishlist Service
  # ===========================
  wishlist-service:
    build: ./HyperchipWishlist
    container_name: wishlist-service
    ports:
      - "8093:8093"
    env_file:
      - .env
    environment:
      SPRING_PROFILES_ACTIVE: prod
      SPRING_DATASOURCE_URL: jdbc:mysql://wishlist-mysql:3306/hyperchip_wishlist_db?useSSL=false&serverTimezone=UTC&allowPublicKeyRetrieval=true
      SPRING_DATASOURCE_USERNAME: root
      SPRING_DATASOURCE_PASSWORD: ${USER_DB_PASSWORD}
      JAVA_OPTS: "-Deureka.client.service-url.defaultZone=http://discovery:8761/eureka"
    depends_on:
      - wishlist-mysql
      - discovery
      - config-server

  # ===========================
  # MySQL for Wallet Service
  # ===========================
  wallet-mysql:
    image: mysql:8
    container_name: wallet-mysql
    restart: always
    environment:
      MYSQL_DATABASE: hyperchip_wallet_db
      MYSQL_ROOT_PASSWORD: ${USER_DB_PASSWORD}
    ports:
      - "3313:3306"
    volumes:
      - wallet-db:/var/lib/mysql

  # ===========================
  # Wallet Service
  # ===========================
  wallet-service:
    build: ./HyperchipWallet
    container_name: wallet-service
    ports:
      - "8095:8095"
    env_file:
      - .env
    environment:
      SPRING_PROFILES_ACTIVE: prod
      SPRING_DATASOURCE_URL: jdbc:mysql://wallet-mysql:3306/hyperchip_wallet_db?useSSL=false&serverTimezone=UTC&allowPublicKeyRetrieval=true
      SPRING_DATASOURCE_USERNAME: root
      SPRING_DATASOURCE_PASSWORD: ${USER_DB_PASSWORD}
      JAVA_OPTS: "-Deureka.client.service-url.defaultZone=http://discovery:8761/eureka"
    depends_on:
      - wallet-mysql
      - discovery
      - config-server


  # ===========================
  # MySQL for Payment Service
  # ===========================
  payment-mysql:
    image: mysql:8
    container_name: payment-mysql
    restart: always
    environment:
      MYSQL_DATABASE: hyperchip_payment_db
      MYSQL_ROOT_PASSWORD: ${DB_PASSWORD}
    ports:
      - "3315:3306"
    volumes:
      - payment-db:/var/lib/mysql


  # ===========================
  # MySQL for Order Service
  # ===========================
  order-mysql:
    image: mysql:8
    container_name: order-mysql
    restart: always
    environment:
      MYSQL_DATABASE: hyperchip_order_db
      MYSQL_ROOT_PASSWORD: ${USER_DB_PASSWORD}
    ports:
      - "3314:3306"
    volumes:
      - order-db:/var/lib/mysql

  # ===========================
  # Order Service
  # ===========================
  order-service:
    build: ./HyperchipOrder
    container_name: order-service
    ports:
      - "8092:8092"
    env_file:
      - .env
    environment:
      SPRING_PROFILES_ACTIVE: prod
      SPRING_DATASOURCE_URL: jdbc:mysql://order-mysql:3306/hyperchip_order_db?useSSL=false&serverTimezone=UTC&allowPublicKeyRetrieval=true
      SPRING_DATASOURCE_USERNAME: root
      SPRING_DATASOURCE_PASSWORD: ${USER_DB_PASSWORD}
      JAVA_OPTS: "-Deureka.client.service-url.defaultZone=http://discovery:8761/eureka"
    depends_on:
      - order-mysql
      - discovery
      - config-server


  # ===========================
  # Payment Service
  # ===========================
  payment-service:
    build: ./HyperchipPayment
    container_name: payment-service
    ports:
      - "8094:8094"
    env_file:
      - .env
    environment:
      SPRING_PROFILES_ACTIVE: prod

      # Database
      SPRING_DATASOURCE_URL: jdbc:mysql://payment-mysql:3306/hyperchip_payment_db?useSSL=false&serverTimezone=UTC&allowPublicKeyRetrieval=true
      SPRING_DATASOURCE_USERNAME: ${DB_USER}
      SPRING_DATASOURCE_PASSWORD: ${DB_PASSWORD}

      # Razorpay
      RAZORPAY_KEY: ${RAZORPAY_KEY}
      RAZORPAY_SECRET: ${RAZORPAY_SECRET}

      # Eureka
      JAVA_OPTS: "-Deureka.client.service-url.defaultZone=http://discovery:8761/eureka"

    depends_on:
      - payment-mysql
      - discovery
      - config-server


# ===========================
# Volumes
# ===========================
volumes:
  auth-db:
  user-db:
  admin-db:
  master-db:
  cart-db:
  wishlist-db:
  wallet-db:
  order-db:
  payment-db:










  # ===========================
  # MySQL for ---- Service
  # ===========================
  # ===========================
  # Admin Service
  # ===========================











