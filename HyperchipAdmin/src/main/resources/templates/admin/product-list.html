<!-- templates/admin/product-list.html -->
<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <link rel="icon" type="image/png" href="/img/logo-tab.png" sizes="64x64"/>
    <title>Product List - Admin</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
    <!-- Custom CSS -->
    <link rel="stylesheet" th:href="@{/css/style.css}" />
</head>
<body>
<!-- Admin header -->
<div th:replace="fragments/admin-header :: adminHeader"></div>
<div class="container mt-4">
    <!-- Flash Messages -->
    <div th:if="${successMsg}" class="alert alert-successTxt alert-success text-center" th:text="${successMsg}"></div>
    <div th:if="${errorMsg}" class="alert alert-danger text-center" th:text="${errorMsg}"></div>
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2>Products</h2>
        <a th:href="@{/admin/products/add}" class="btn btn-success">Add New Product</a>
    </div>
    <!-- ================= FILTERS (same style as Brands/Categories) ================= -->
    <!--    <form method="get" th:action="@{/admin/products}">-->
    <!--        <div class="input-group mb-3">-->
    <!--            &lt;!&ndash; Search text &ndash;&gt;-->
    <!--            <input type="text"-->
    <!--                   name="q"-->
    <!--                   class="form-control"-->
    <!--                   placeholder="Search products..."-->
    <!--                   th:value="${q}" />-->
    <!--            &lt;!&ndash; Category dropdown &ndash;&gt;-->
    <!--            <select name="category" class="form-select">-->
    <!--                <option value="">All Categories</option>-->
    <!--                <option th:each="cat : ${categories}"-->
    <!--                        th:value="${cat.id}"-->
    <!--                        th:text="${cat.name}"-->
    <!--                        th:selected="${cat.id == category}">-->
    <!--                </option>-->
    <!--            </select>-->
    <!--            &lt;!&ndash; Search button (two words) &ndash;&gt;-->
    <!--            <button class="btn btn-outline-secondary" type="submit">-->
    <!--                Search Products-->
    <!--            </button>-->
    <!--            &lt;!&ndash; Clear button &ndash;&gt;-->
    <!--            <a class="btn btn-outline-secondary"-->
    <!--               th:href="@{/admin/products}">-->
    <!--                Clear-->
    <!--            </a>-->
    <!--        </div>-->
    <!--    </form>-->
    <form method="get" th:action="@{/admin/products}">
        <div class="input-group mb-3">
            <input type="text"
                   name="q"
                   class="form-control"
                   placeholder="Search products..."
                   th:value="${q}" />
            <button class="btn btn-outline-secondary" type="submit">Search Products</button>
            <a class="btn btn-outline-secondary" th:href="@{/admin/products}">Clear</a>
        </div>
    </form>
    <!-- ========================================================================== -->
    <!-- Products Table -->
    <div class="table-responsive">
        <table class="table table-bordered table-hover align-middle">
            <thead class="table-dark">
            <tr>
                <th>ID</th>
                <th>Title</th>
                <!-- <th>Category</th> -->
                <!-- <th>Brand</th> -->
                <th>Images</th>
                <th>Price</th>
                <th>Stock</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
            </thead>
            <tbody>
            <!-- No products -->
            <tr th:if="${products == null or products.content == null or #lists.isEmpty(products.content)}">
                <td colspan="7" class="text-center">No products found.</td>
            </tr>
            <!-- Product rows -->
            <tr th:each="product, iter : ${products.content}">
                <td th:text="${product.id}"></td>
                <td th:text="${product.title}">Title</td>
                <!-- First image only, small thumbnail -->
                <td>
                    <img th:if="${product.imageNames != null and product.imageNames.size() > 0}"
                         th:src="${masterBaseUrl + '/uploads/products/' + product.imageNames[0]}"
                         alt="Product Image"
                         style="height:50px; width:50px; object-fit:cover;" />
                </td>
                <td th:text="${product.price != null ? product.price : '-'}">Price</td>
                <td th:text="${product.stock != null ? product.stock : 0}">Stock</td>
                <td th:text="${product.active != null && product.active ? 'Active' : 'Inactive'}">Status</td>
                <td class="text-nowrap">
                    <a th:href="@{'/admin/products/edit/' + ${product.id}}"
                       class="btn btn-sm btn-warning me-1">
                        Edit
                    </a>
                    <a th:href="@{'/admin/products/delete/' + ${product.id}}"
                       class="btn btn-sm btn-danger"
                       onclick="return confirm('Are you sure you want to delete this product?');">
                        Delete
                    </a>
                </td>
            </tr>
            </tbody>
        </table>
    </div>
    <!-- Pagination -->
    <nav th:if="${products != null and products.totalPages > 1}">
        <ul class="pagination justify-content-center">
            <li class="page-item" th:classappend="${products.first} ? 'disabled'">
                <a class="page-link"
                   th:href="@{/admin/products(page=${products.number - 1}, size=${products.size}, q=${q}, category=${category})}">
                    Previous
                </a>
            </li>
            <li class="page-item"
                th:each="i : ${#numbers.sequence(0, products.totalPages-1)}"
                th:classappend="${i == products.number} ? 'active'">
                <a class="page-link"
                   th:href="@{/admin/products(page=${i}, size=${products.size}, q=${q}, category=${category})}"
                   th:text="${i + 1}">
                </a>
            </li>
            <li class="page-item" th:classappend="${products.last} ? 'disabled'">
                <a class="page-link"
                   th:href="@{/admin/products(page=${products.number + 1}, size=${products.size}, q=${q}, category=${category})}">
                    Next
                </a>
            </li>
        </ul>
    </nav>
</div>
<!-- Footer fragment -->
<div th:replace="fragments/admin-footer :: adminFooter"></div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>