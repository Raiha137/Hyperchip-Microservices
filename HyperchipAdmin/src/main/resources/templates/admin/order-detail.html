<!-- src/main/resources/templates/admin/order-detail.html -->
<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <link rel="icon" type="image/png" href="/img/logo-tab.png" sizes="64x64"/>
    <title>Order Detail</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
    <style>
        body {
        background-color: #f8f9fa;
        }
        /* ===== Top order card ===== */
        .order-header-card {
        max-width: 1000px;
        margin: 0 auto 1.5rem auto;
        }
        .order-header-card .order-title {
        font-size: 1.6rem;
        font-weight: 600;
        text-align: center;
        margin-bottom: 1.2rem;
        }
        .order-meta-label {
        font-weight: 600;
        color: #b8860b; /* gold-brown */
        margin-right: 4px;
        }
        .order-meta-value {
        color: #000;
        }
        .order-status-badge {
        display: inline-block;
        padding: 0.2rem 0.9rem;
        border-radius: 999px;
        background-color: #ffe4b5;
        color: #b86a00;
        font-weight: 600;
        font-size: 0.9rem;
        }
        /* ===== Items table ===== */
        .items-title {
        text-align: center;
        margin: 1.5rem 0 1rem 0;
        font-weight: 600;
        }
        .table-order-items thead {
        background-color: #000;
        color: #ffffff;
        }
        .table-order-items tbody td {
        color: #2c3e50;
        }
        .order-total-label {
        font-weight: 600;
        color: #2c3e50;
        }
        .order-total-value {
        font-weight: 700;
        color: #b8860b;
        }
        /* ===== Change status ===== */
        .change-status-title {
        text-align: center;
        margin-bottom: 1rem;
        font-weight: 600;
        }
        .order-txt th {
        color: #fff;
        }
        .order-price-tab span,
        .order-lft-txt span,
        .price-Txt span {
        color: #000;
        }
    </style>
</head>
<body>
<div th:replace="fragments/admin-header :: adminHeader"></div>
<div class="container mt-4">
    <a th:href="@{/admin/orders}" class="btn btn-outline-secondary mb-3">Back to Orders</a>
    <!-- ================= TOP ORDER CARD ================= -->
    <div class="card mb-3 order-header-card">
        <div class="card-body">
            <h4 class="order-title">
                Order
                <span th:text="${order.orderNumber}">ORD-001</span>
            </h4>
            <div class="row align-items-center justify-content-between">
                <!-- LEFT: order info (NO OFFSET NOW) -->
                <div class="col-md-6 text-md-start text-center order-lft-txt">
                    <p>
                        <span class="order-meta-label">Order Date:</span>
                        <span class="order-meta-value">
                        <span th:if="${order.orderDate != null}"
                              th:text="${#temporals.format(order.orderDate,'dd-MMM-yyyy HH:mm')}">
                        17-Oct-2025 16:17
                        </span>
                        <span th:unless="${order.orderDate != null}">-</span>
                        </span>
                    </p>
                    <p>
                        <span class="order-meta-label">User ID:</span>
                        <span class="order-meta-value"
                              th:text="${order.userId != null ? order.userId : '-'}">1</span>
                    </p>
                    <p>
                        <span class="order-meta-label">Status:</span>
                        <span class="order-status-badge"
                              th:text="${order.status != null ? order.status : '-'}">PENDING</span>
                    </p>
                </div>
                <!-- RIGHT: invoice button -->
                <div class="col-md-4 text-md-end text-center mt-3 mt-md-0">
                    <a th:href="@{|/admin/orders/${order.orderId}/invoice|}"
                       class="btn btn-outline-primary">
                        Download Invoice
                    </a>
                </div>
            </div>
        </div>
    </div>
    <!-- ================= ITEMS CARD ================= -->
    <div class="card mb-3">
        <div class="card-body">
            <h5 class="items-title">Items</h5>
            <table class="table table-order-items order-txt">
                <thead>
                <tr>
                    <th>PRODUCT</th>
                    <th>QTY</th>
                    <th>UNIT PRICE</th>
                    <th>TOTAL</th>
                </tr>
                </thead>
                <tbody class="price-Txt">
                <tr th:if="${order.items == null or #lists.isEmpty(order.items)}">
                    <td colspan="4" class="text-center">No items for this order</td>
                </tr>
                <tr th:each="it : ${order.items}"
                    th:classappend="${it.cancelled} ? 'table-secondary text-muted' : ''">
                    <td>
                           <span th:text="${it.productName != null ? it.productName : 'Product #' + (it.productId != null ? it.productId : '-') }">
                           Product A
                           </span>
                        <span th:if="${it.cancelled}" class="badge bg-danger ms-2">Cancelled</span>
                    </td>
                    <td th:text="${it.quantity != null ? it.quantity : 0}">1</td>
                    <td>
                           <span th:if="${it.unitPrice != null}"
                                 th:text="${#numbers.formatDecimal(it.unitPrice,1,2)}">50.00</span>
                        <span th:unless="${it.unitPrice != null}">0.00</span>
                    </td>
                    <td>
                           <span th:if="${it.total != null}"
                                 th:text="${#numbers.formatDecimal(it.total,1,2)}">50.00</span>
                        <span th:unless="${it.total != null}">
                           <span th:text="${(it.unitPrice != null && it.quantity != null) ?
                              #numbers.formatDecimal(it.unitPrice * it.quantity,1,2) : '0.00'}">
                           0.00
                           </span>
                           </span>
                    </td>
                </tr>
                </tbody>
            </table>
            <div class="text-end mt-3 order-price-tab">
                <span class="order-total-label">Total: </span>
                <span class="order-total-value">
                  <span th:if="${order.total != null}"
                        th:text="${#numbers.formatDecimal(order.total,1,2)}">100.00</span>
                  <span th:unless="${order.total != null}">0.00</span>
                  </span>
            </div>
        </div>
    </div>
    <!-- ================= CHANGE STATUS CARD ================= -->
    <div class="card">
        <div class="card-body">
            <h5 class="change-status-title">Change Status</h5>
            <form th:action="@{|/admin/orders/${order.orderId}/status|}" method="post"
                  class="row g-2 justify-content-center">
                <div class="col-md-4">
                    <select name="status" class="form-select">
                        <option value="PENDING" th:selected="${order.status == 'PENDING'}">Pending</option>
                        <option value="CONFIRMED" th:selected="${order.status == 'CONFIRMED'}">Confirmed</option>
                        <option value="PACKED" th:selected="${order.status == 'PACKED'}">Packed</option>
                        <option value="SHIPPED" th:selected="${order.status == 'SHIPPED'}">Shipped</option>
                        <option value="OUT_FOR_DELIVERY" th:selected="${order.status == 'OUT_FOR_DELIVERY'}">Out for Delivery</option>
                        <option value="DELIVERED" th:selected="${order.status == 'DELIVERED'}">Delivered</option>
                        <option value="CANCELLED" th:selected="${order.status == 'CANCELLED'}">Cancelled</option>
                        <option value="RETURNED" th:selected="${order.status == 'RETURNED'}">Returned</option>
                        <option value="RETURN_REQUESTED">Return Requested</option>
                        <option value="REPLACEMENT_REQUESTED">Replacement Requested</option>
                        <option value="REPLACED">Replaced</option>
                    </select>
                </div>
                <div class="col-md-4">
                    <input type="text" name="note" class="form-control" placeholder="Optional note"/>
                </div>
                <div class="col-md-2">
                    <button class="btn btn-primary w-100" type="submit">Update</button>
                </div>
            </form>
        </div>
    </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>