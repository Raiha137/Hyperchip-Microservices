<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Sales Report - Hyperchip Admin</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <style>
        .sales-page {
        min-height: 100vh;
        background-color: #050b12;
        color: #fff;
        padding-top: 80px;
        padding-bottom: 40px;
        }
        .sales-card {
        background-color: #08131e;
        border-radius: 12px;
        box-shadow: 0 6px 24px rgba(0,0,0,0.4);
        padding: 20px 24px;
        }
        .sales-card h4 {
        color: #f3a111;
        font-weight: 600;
        }
        .sales-label {
        font-weight: 500;
        color: #f8f9fa;
        }
        .btn-amber {
        background-color: #f3a111;
        border-color: #f3a111;
        color: #000;
        }
        .btn-amber:hover {
        background-color: #ee831b;
        border-color: #ee831b;
        color: #000;
        }
        table thead {
        background-color: #102131;
        }
        table thead th {
        color: #f3a111;
        }
        table tbody tr {
        background-color: #0b1825;
        }
        table tbody tr:nth-child(even) {
        background-color: #101d2b;
        }
    </style>
</head>
<body>
<div th:replace="fragments/admin-header :: adminHeader"></div>
<div class="container sales-page">
    <div class="row mb-4">
        <div class="col-12">
            <div class="sales-card">
                <h4 class="mb-3">Sales Report</h4>
                <form th:action="@{/admin/reports/sales}" method="get" class="row g-3">
                    <div class="col-md-3">
                        <label class="form-label sales-label">Period</label>
                        <select class="form-select" name="periodType" th:value="${filter.periodType}">
                            <option value="DAY" th:selected="${filter.periodType}=='DAY'">Today</option>
                            <option value="WEEK" th:selected="${filter.periodType}=='WEEK'">Last 7 Days</option>
                            <option value="MONTH" th:selected="${filter.periodType}=='MONTH'">This Month</option>
                            <option value="CUSTOM" th:selected="${filter.periodType}=='CUSTOM'">Custom</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label sales-label">From Date</label>
                        <input type="date" class="form-control" name="fromDate"
                               th:value="${filter.fromDate != null ? #temporals.format(filter.fromDate, 'yyyy-MM-dd') : ''}">
                    </div>
                    <div class="col-md-3">
                        <label class="form-label sales-label">To Date</label>
                        <input type="date" class="form-control" name="toDate"
                               th:value="${filter.toDate != null ? #temporals.format(filter.toDate, 'yyyy-MM-dd') : ''}">
                    </div>
                    <div class="col-md-3">
                        <label class="form-label sales-label">Payment Method</label>
                        <select class="form-select" name="paymentMethod">
                            <option value="" th:selected="${filter.paymentMethod}==null">All</option>
                            <option value="COD" th:selected="${filter.paymentMethod}=='COD'">COD</option>
                            <option value="RAZORPAY" th:selected="${filter.paymentMethod}=='RAZORPAY'">Razorpay</option>
                            <option value="WALLET" th:selected="${filter.paymentMethod}=='WALLET'">Wallet</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label sales-label">Order Status</label>
                        <select class="form-select" name="orderStatus">
                            <option value="" th:selected="${filter.orderStatus}==null">All</option>
                            <option value="PENDING" th:selected="${filter.orderStatus}=='PENDING'">PENDING</option>
                            <option value="CONFIRMED" th:selected="${filter.orderStatus}=='CONFIRMED'">CONFIRMED</option>
                            <option value="DELIVERED" th:selected="${filter.orderStatus}=='DELIVERED'">DELIVERED</option>
                            <option value="CANCELLED" th:selected="${filter.orderStatus}=='CANCELLED'">CANCELLED</option>
                            <option value="RETURNED" th:selected="${filter.orderStatus}=='RETURNED'">RETURNED</option>
                        </select>
                    </div>
                    <div class="col-md-3 d-flex align-items-end">
                        <button type="submit" class="btn btn-amber w-100">Filter</button>
                    </div>
                    <div class="col-md-3 d-flex align-items-end">
                        <a class="btn btn-outline-light w-100"
                           th:href="@{/admin/reports/sales}">Reset</a>
                    </div>
                    <div class="col-md-3 d-flex align-items-end">
                        <a class="btn btn-amber w-100"
                           th:href="@{/admin/reports/sales/export/pdf(
                           periodType=${filter.periodType},
                           fromDate=${filter.fromDate},
                           toDate=${filter.toDate},
                           paymentMethod=${filter.paymentMethod},
                           orderStatus=${filter.orderStatus}
                           )}">
                            Download PDF
                        </a>
                    </div>
                    <div class="col-md-3 d-flex align-items-end">
                        <a class="btn btn-amber w-100"
                           th:href="@{/admin/reports/sales/export/excel(
                           periodType=${filter.periodType},
                           fromDate=${filter.fromDate},
                           toDate=${filter.toDate},
                           paymentMethod=${filter.paymentMethod},
                           orderStatus=${filter.orderStatus}
                           )}">
                            Download Excel
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <!-- TABLE + SUMMARY -->
    <div class="row">
        <div class="col-12">
            <div class="sales-card">
                <h5 class="mb-3">Report Result</h5>
                <div th:if="${report != null and #lists.isEmpty(report.rows)}">
                    <p>No orders found for the selected filters.</p>
                </div>
                <div th:if="${report != null and !#lists.isEmpty(report.rows)}">
                    <div class="table-responsive mb-3">
                        <table class="table table-sm table-borderless align-middle">
                            <thead>
                            <tr>
                                <th>#</th>
                                <th>Order #</th>
                                <th>Date/Time</th>
                                <th>User Email</th>
                                <th>Payment</th>
                                <th>Status</th>
                                <th class="text-end">Subtotal</th>
                                <th class="text-end">Coupon Disc.</th>
                                <th class="text-end">Final Amount</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr th:each="row, stat : ${report.rows}">
                                <td th:text="${stat.index + 1}"></td>
                                <td th:text="${row.orderNumber}"></td>
                                <td th:text="${row.orderDate != null ? #temporals.format(row.orderDate, 'yyyy-MM-dd HH:mm') : ''}"></td>
                                <td th:text="${row.userEmail}"></td>
                                <td th:text="${row.paymentMethod}"></td>
                                <td th:text="${row.orderStatus}"></td>
                                <td class="text-end" th:text="${row.subTotal}"></td>
                                <td class="text-end" th:text="${row.couponDiscount}"></td>
                                <td class="text-end" th:text="${row.finalAmount}"></td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <h6>Summary</h6>
                            <p th:text="'Total Orders: ' + ${report.summary.totalOrders}"></p>
                            <p th:text="'Total Order Amount: ' + ${report.summary.totalOrderAmount}"></p>
                            <p th:text="'Total Coupon Discount: ' + ${report.summary.totalCouponDiscount}"></p>
                            <p th:text="'Total Final Amount: ' + ${report.summary.totalFinalAmount}"></p>
                            <p th:text="'Overall Discount: ' + ${report.summary.overallDiscount}"></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div th:replace="fragments/admin-footer :: adminFooter"></div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>